var textSt = `THE GRATEFUL BEASTS AND THE UNGRATEFUL PRINCE
Once upon a time there was a King, and he had a son.
And this son was so cruel and disagreeable, that he took a delight in hurting people, and never spoke to anybody without an oath or a blow.
He was a thorn in the flesh to everybody he came across; he was like grit in the porridge, like a fly in the eye, like a stone in the shoon.
And they called him the Wicked Prince.
One day the Wicked Prince went down to the river to bathe, along with a number of servants.
By-and-by a great storm came on, and the clouds were so thick that it became pitch-dark.
However, this Prince was obstinate, and would not give up his bathe; and as he was too lazy even to bathe himself, he swore at his servants, and said: "You lazy beasts! Bathe me, and look sharp about it, or I'll tickle you with a cat-o'-nine-tails!"
Now the servants had had enough of this young bully; and thought they, "What if we pitch him into the river, where the current is strong, and just leave him there! We can easily pretend he was carried away where we could not reach him; and if the King finds us out, and puts us to death--anyhow, death is better than his eternal bullying."
So they pitched him head over heels into the water, though he screamed and struggled, and then they went home and told the King that he had gone in to bathe, and a flood carried him away.
I daresay it was wicked of them to tell such a lie, but it was more the Prince's fault than theirs.
Meanwhile the Prince had got hold of a tree that had been torn up by the roots, and climbing upon it, went floating down the river.
Now on the banks of this river lived a Snake.
This Snake had once been a very rich man, and he had buried a vast treasure on the river bank; and he loved his riches more than he loved his own soul, so when he died, he was born again as a Snake, and had to live for ever close to his buried hoard.
And a Rat that lived close by had also been a man once, and buried his money as the Snake had done, instead of using it in doing good; so he was born as a Rat, and made a hole where his money lay.
These two creatures were caught by the flood, and it so happened that they saw the tree where the Wicked Prince was, and swimming to it, each got on one end, while the Prince was in the middle.
And a young Parrot flying through the air, was beaten down by the rain; for in that country the drops of rain are as big as pigeons' eggs, and no birds can fly through it.
Then it so happened that this Parrot dropped down upon the same tree where the Snake was, and the Rat, and the Wicked Prince; and so there were four of them on the tree, floating down the river.
As the tree came near to a bend in the river, it was washed close to the bank.
And on the bank a man was sitting.
He did not mind the rain a bit, because he was a Hermit, who thought the world so wicked that he left it and went to live in the jungle all by himself.
He built himself a little hut by the riverside, and, wet or fine, he cared not a jot.
This man saw the tree, and managed to catch hold of it and pull it ashore.
Then he got the four creatures off it, and took them into his hut, and dried them and warmed them by the fire.
But he began with the Parrot, because she looked the most miserable of them all; and then he dried the Rat; and next the Snake; and only attended to the man when he had comforted the other three.
This made the Wicked Prince very angry.
If he abused even those who made much of him, you may imagine how he cursed and swore in his heart at this man who left him to the last!
But he said nothing, because he was afraid that if he did the man might turn him out in the storm again.
In a day or two the rain stopped, and the flood went down; and the creatures were all right again as they took their leave of the Hermit.
The Snake thanked him for his kindness and said: "You have saved my life, good Hermit! What can I do for you? You seem to be a poor man; I am rich, and if you ever want money just come to my hole and call 'Snake,' and you shall have all my treasure. Good-bye!" The Rat said the same.
The Parrot was very sorry to think that she had no money, so she said: "Silver and gold have I none; but if you ever are hungry, and want some rice, come to my tree and call 'Parrot,' and I'll get you as much rice as ever you like."
But the Wicked Prince hated this kind Hermit, because he had been left to the last.
However, he pretended to be grateful, and said to the Hermit: "I hope you will pay me a visit soon. I am a Prince, and I shall be glad of a chance to repay you for all you have done for me."
Then he went away, chuckling to think how he would torment the poor Hermit, if ever he got him into his power.
This Hermit had all his wits about him, and he knew that people often promise what they never mean to do; so after a while he thought he would put them all to the test.
So first he took his stick, and journeyed to the city where the Wicked Prince lived.
The Prince, who was King himself now, saw him coming, and thought to himself: "Aha! here's that rascal that left me to the last. Wants me to pay him for it, I suppose! Well, I'll pay him! I'll pay him out!"
So he called to his men: "Hi there, brutes! do you see that fellow? He tried to rob me the other day--just catch him and give him a flogging, and then stick a stake through his body, and leave him to die!"
Then the servants caught the Hermit, and flogged him well.
But the Hermit did not cry out or grumble, only kept on saying to himself quietly: "The proverb's true, the proverb's true!"
"What proverb do you mean?" they asked him.
"It's unlucky to save a drowning man," said the Hermit.
Then he told them the whole story, and very angry they were when they heard it.
They stopped beating the Hermit at once, and seizing the Wicked King, they beat him instead, and stuck a stake through his body, and left him to die.
Then they made the Hermit King instead of the Wicked Prince.
And the Hermit took them a walk into the country, and when they came to the Snake's hole he called out "Snake!"
Out came the Snake, and curled up against his feet, and showed him the hole where his treasure was; and the Hermit gave it all to his servants.
And then they went to the Rat's hole, and he called out "Rat!" And the Rat ran up, and rubbed his nose against the King's hand, and gave him all his treasure, which the King gave to his servants as well as the other.
And last of all they went to the Parrot's tree, and called "Parrot!" And the Parrot flew up and gave a call, and instantly all the air was black with Parrots.
And all the Parrots carried a grain of rice in their beaks, and dropped it on the ground; and there was such a heap of rice, that it was enough to feed all the people for the rest of their lives.
So the grateful beasts kept their promise, and the ungrateful Prince was killed, and the Hermit ruled over his people kindly, and they all lived happily until they died.
And when they died they all went to heaven; and the Snake and the Rat and the Parrot went there too, because they had at last overcome their love of money, and given it away to show how grateful they were to the Hermit for being kind to them.

<muoborder>

LOS ANIMALES AGRADECIDOS Y EL PRÍNCIPE DESAGRADECIDO
Había una vez un Rey, y tenía un hijo.
Y este hijo era tan cruel y desagradable, que se deleitaba en lastimar a la gente, y nunca hablaba a nadie sin un juramento o un golpe.
Era una espina en la carne de todo el que se cruzaba con él; era como arena en el puré, como una mosca en el ojo, como una piedra en el zapato.
Y lo llamaban el Príncipe Malvado.
Un día, el Príncipe Malvado bajó al río a bañarse, junto con un número de sirvientes.
Poco a poco, se desató una gran tormenta, y las nubes eran tan espesas que se volvió oscuro como boca de lobo.
Sin embargo, este Príncipe era obstinado y no renunciaría a su baño; y como era demasiado perezoso incluso para bañarse él mismo, juraba a sus sirvientes y decía: "¡Bestias perezosas! ¡Báñenme y háganlo rápido, o los azotaré con un látigo!"
Ahora los sirvientes habían tenido suficiente de este joven matón; y pensaron: "¿Y si lo arrojamos al río, donde la corriente es fuerte, y lo dejamos allí? Podemos fingir fácilmente que fue arrastrado a donde no podíamos alcanzarlo; y si el Rey nos descubre y nos pone a muerte, de todos modos, la muerte es mejor que su eterno acoso".
Así que lo arrojaron de cabeza al agua, aunque gritaba y se debatía, y luego se fueron a casa y le dijeron al Rey que se había metido a bañar y que una inundación se lo había llevado.
Supongo que fue malvado de su parte decir tal mentira, pero fue más culpa del Príncipe que de ellos.
Mientras tanto, el Príncipe se había aferrado a un árbol que había sido arrancado de raíz, y subiéndose a él, fue flotando río abajo.
Ahora, en las orillas de este río vivía una Serpiente.
Esta Serpiente había sido una vez un hombre muy rico, y había enterrado un gran tesoro en la orilla del río; y amaba sus riquezas más que a su propia alma, así que cuando murió, nació de nuevo como una Serpiente y tuvo que vivir para siempre cerca de su tesoro enterrado.
Y una Rata que vivía cerca también había sido una vez un hombre, y había enterrado su dinero como lo había hecho la Serpiente, en lugar de usarlo para hacer el bien; así que nació como una Rata y hizo un agujero donde estaba su dinero.
Estas dos criaturas fueron atrapadas por la inundación, y sucedió que vieron el árbol donde estaba el Príncipe Malvado, y nadando hacia él, cada uno se subió a un extremo, mientras que el Príncipe estaba en el medio.
Y un joven Loro que volaba por el aire, fue golpeado por la lluvia; porque en ese país, las gotas de lluvia son tan grandes como huevos de paloma, y ningún pájaro puede volar a través de ellas.
Entonces sucedió que este Loro cayó sobre el mismo árbol donde estaba la Serpiente, la Rata y el Príncipe Malvado; y así había cuatro de ellos en el árbol, flotando río abajo.
Cuando el árbol se acercó a una curva del río, fue arrastrado cerca de la orilla.
Y en la orilla había un hombre sentado.
NO SE PREOCUPABA POR LA LLUVIA EN ABSOLUTO, PORQUE ERA UN ERMITAÑO QUE PENSABA QUE EL MUNDO ERA TAN MALVADO QUE LO DEJÓ Y SE FUE A VIVIR AL BOSQUE SOLO.
Se construyó una pequeña cabaña a la orilla del río, y no le importaba si llovía o hacía sol.
Este hombre vio el árbol y logró agarrarlo y sacarlo a la orilla.
Luego sacó a las cuatro criaturas y las llevó a su cabaña, las secó y las calentó junto al fuego.
Pero comenzó con el Loro, porque parecía la más miserable de todas; luego secó a la Rata; y después a la Serpiente; y solo atendió al hombre cuando había consolado a los otros tres.
Esto enfureció mucho al Príncipe Malvado.
¡Si insultaba incluso a quienes lo mimaban, puedes imaginar cómo maldecía y juraba en su corazón a este hombre que lo dejó para el final!
Pero no dijo nada, porque tenía miedo de que si lo hacía, el hombre pudiera echarlo de nuevo a la tormenta.
Al cabo de un par de días, la lluvia se detuvo y la inundación bajó; y las criaturas estaban bien de nuevo cuando se despidieron del Ermitaño.
La Serpiente le agradeció por su amabilidad y dijo: "¡Has salvado mi vida, buen Ermitaño! ¿Qué puedo hacer por ti? Pareces ser un hombre pobre; soy rico y si alguna vez necesitas dinero, solo ven a mi agujero y llama 'Serpiente', y tendrás todo mi tesoro. ¡Adiós!" La Rata dijo lo mismo.
El Loro lamentaba mucho no tener dinero, así que dijo: "Plata y oro no tengo; pero si alguna vez tienes hambre y quieres arroz, ven a mi árbol y llama 'Loro', y te conseguiré todo el arroz que quieras".
Pero el Príncipe Malvado odiaba a este amable Ermitaño, porque lo habían dejado para el final.
Sin embargo, fingió estar agradecido y le dijo al Ermitaño: "Espero que me hagas una visita pronto. Soy un Príncipe y me alegrarás de tener la oportunidad de recompensarte por todo lo que has hecho por mí".
Luego se fue, riéndose al pensar en cómo atormentaría al pobre Ermitaño si alguna vez lo tuviera en su poder.
Este Ermitaño tenía todos sus sentidos alerta, y sabía que la gente a menudo promete lo que nunca tiene la intención de hacer; así que después de un tiempo pensó que los pondría a prueba a todos.
Entonces primero tomó su bastón y viajó a la ciudad donde vivía el Príncipe Malvado.
El Príncipe, que ahora era Rey, lo vio venir y pensó para sí: "¡Ajá! Aquí está ese bribón que me dejó para el final. ¡Supongo que quiere que le pague por eso! ¡Bueno, le pagaré! ¡Le pagaré!"
Entonces llamó a sus hombres: "¡Eh, bestias! ¿Ven a ese tipo? Intentó robarme el otro día, solo atrápalo y azótalo, y luego clávale una estaca en el cuerpo y déjalo morir!"
Entonces los sirvientes atraparon al Ermitaño y lo azotaron bien.
Pero el Ermitaño no gritó ni se quejó, solo seguía diciendo en voz baja: "El refrán es cierto, el refrán es cierto".
"¿Qué proverbio quieres decir?" le preguntaron.
"Es de mala suerte salvar a un hombre que se está ahogando", dijo el Ermitaño.
Entonces les contó toda la historia, y se enojaron mucho cuando la escucharon.
Dejaron de golpear al Ermitaño de inmediato y, agarrando al Rey Malvado, lo golpearon en su lugar y le clavaron una estaca en el cuerpo, dejándolo morir.
Entonces hicieron que el Ermitaño fuera el Rey en lugar del Príncipe Malvado.
Y el Ermitaño los llevó a dar un paseo por el campo, y cuando llegaron al agujero de la Serpiente, gritó "¡Serpiente!".
Salió la Serpiente y se enrolló a sus pies, y le mostró el agujero donde estaba su tesoro; y el Ermitaño se lo dio todo a sus sirvientes.
Y luego fueron al agujero de la Rata, y él gritó "¡Rata!". Y la Rata subió y le frotó la nariz contra la mano del Rey, y le dio todo su tesoro, que el Rey también dio a sus sirvientes.
Y por último fueron al árbol del Loro, y llamaron "¡Loro!". Y el Loro voló y dio un grito, y al instante todo el aire se oscureció con Loros.
Y todos los Loros llevaban un grano de arroz en sus picos, y lo dejaban caer al suelo; y había tal montón de arroz, que era suficiente para alimentar a toda la gente por el resto de sus vidas.
Así que las agradecidas bestias cumplieron su promesa, y el Príncipe ingrato fue asesinado, y el Ermitaño gobernó a su pueblo con bondad, y todos vivieron felices hasta que murieron.
Y cuando murieron, todos fueron al cielo; y la Serpiente, la Rata y el Loro también fueron allí, porque finalmente habían superado su amor por el dinero y lo habían dado para mostrar cuán agradecidos estaban al Ermitaño por ser amable con ellos.`;

var spanishDictionary = `["abajo - below","absoluto - absolute","acercó - approached","acoso - harassment / pursuit","adiós - goodbye / farewell","aferrado - clinging / gripped / stubbornly attached","agarrando - grabbing / seizing","agarrarlo - to grab him / it","agradecidas - grateful (feminine plural)","agradecido - grateful / thankful","agradecidos - grateful","agradeció - he/she thanked","agua - water","agujero - hole","ahogando - drowning / choking","ahora - now","aire - air","ajá - aha / uh-huh","al - to the (a + el)","alcanzarlo - to reach him / it; to catch up with him / it","alegrarás - you will make happy / cheer up","alerta - alert / warning","alguna - some","alimentar - to feed / nourish","allí - there","alma - soul","amaba - he/she loved","amabilidad - kindness","amable - kind, friendly","amor - love","animales - animals","aquí - here","árbol - tree","arena - sand","arrancado - torn out / pulled up / yanked free","arrastrado - dragged","arrojamos - we threw / we cast","arrojaron - they threw / they cast","arroz - rice","asesinado - murdered / assassinated","así - thus, so, in this way","atendió - he/she attended to / took care of / served","atormentaría - he/she would torment","atrapadas - trapped (feminine plural)","atrápalo - catch him/it! (command)","atraparon - they caught","aunque - although / even though","azótalo - whip him/it! (command)","azotaré - I will whip / I will beat","azotaron - they whipped / beat","baja - low","bajó - went down / got off / lowered","bañar - to bathe / to wash over","bañarse - to bathe oneself","báñenme - bathe me (formal or plural command)","baño - bath / bathroom","bastón - cane / walking-stick","bestias - beasts","bien - well, good","boca - mouth","bondad - kindness","bosque - forest, woods","bribón - rascal / scoundrel","buen - good (short form of 'bueno')","bueno - good / well / okay","cabaña - cabin","cabeza - head","cabo - end; “llevar a cabo” = to carry out","cada - each, every","caer - to fall","calentó - warmed","campo - field / countryside","carne - meat, flesh","casa - house, home","cayó - he/she fell","cerca - near","cielo - sky, heaven","cierto - true, certain","ciudad - city","clávale - stab him/it! (command)","clavaron - they stabbed / nailed","comenzó - he/she/it began/started (from comenzar)","como - as, like, how","cómo - how","con - with","conseguiré - I will get / obtain","consolado - consoled / comforted","construyó - he/she built / constructed","contó - told / counted","contra - against","corazón - heart","corriente - current","criaturas - creatures","cruel - cruel","cruzaba - he/she used to cross / was crossing","cuán - how (intensifier)","cuando - when","cuatro - four","cuerpo - body","culpa - blame / guilt / fault","cumplieron - they fulfilled / carried out","curva - curve / bend","dado - given / die (dice)","dar - to give","de - of, from","debatía - he/she was debating / arguing","decía - said","decir - say","dejaban - they left / were leaving","dejado - left / allowed","déjalo - leave him/it! let him go!","dejamos - we leave / let","dejándolo - leaving him / it","dejaron - they left","dejó - left / let / dropped","del - of the (de + el)","deleitaba - he/she used to delight / was delighting","demasiado - too much / too many","desagradable - unpleasant","desagradecido - ungrateful","desató - unleashed","descubre - he/she discovers / reveals","despidieron - they fired / dismissed / said goodbye","después - after, afterwards","detuvo - stopped","día - day","días - days","diciendo - saying","dijeron - they said","dijo - he/she/it said (from decir)","dinero - money","dio - he/she/it gave (from dar)","donde - where","dos - two","echarlo - to throw him/it out; to dismiss him","eh - hey / eh","él - he","el - the","ellas - they","ellos - they (masculine)","embargo - however (used in the phrase sin embargo - nevertheless)","en - in, on","enfureció - enraged / infuriated","enojaron - they got angry","enrolló - he/she coiled / wrapped","enterrado - buried","entonces - then, so","era - was, used to be (from ser)","eran - they were, used to be (from ser)","ermitaño - hermit","es - is (from ser)","escucharon - they listened","ese - that (masculine)","eso - that (neuter)","espero - I hope","espesas - thick (feminine plural)","espina - thorn","está - is (from estar)","esta - this (feminine singular)","estaba - was (from estar)","estaban - they were (from estar)","estaca - stake","estar - to be (temporary state)","estas - these (feminine) / you are (informal)","este - this (masculine singular)","esto - this (neuter)","eterno - eternal","extremo - extreme / end / tip","fácilmente - easily","felices - happy","final - end, final","finalmente - finally","fingió - he/she pretended / feigned","fingir - to pretend / to feign","flotando - floating","frotó - rubbed","fue - was, went (from ser or ir)","fuego - fire","fuera - outside, away, or were/was (subjunctive of ser or ir)","fueron - they were / they went","fuerte - strong","gente - people","gobernó - he/she governed / ruled","golpe - blow / hit / strike","golpeado - beaten / struck / hit","golpear - to hit","golpearon - struck / hit","gotas - drops / droplets","gran - great (shortened form of grande)","grandes - large","grano - grain / seed / pimple","gritaba - he/she was shouting / kept shouting","gritó - he/she/it shouted/cried out (from gritar)","grito - shout / scream","había - there was, there were, had (from haber)","habían - they had, there were (from haber)","hablaba - he/she spoke","hacer - to do, to make","hacia - towards","hacía - was doing/making, used to do/make (from hacer)","háganlo - do it (formal or plural command)","hagas - you do / you make (subjunctive)","hambre - hunger","has - you have (present perfect auxiliary)","hasta - until, up to, even","hecho - fact, deed, or done/made (past participle of hacer)","hicieron - they did / made","hijo - son","historia - story / history","hizo - he/she/it did/made (from hacer)","hombre - man","hombres - men","huevos - eggs","imaginar - to imagine","importaba - it mattered","incluso - even, including","ingrato - ungrateful","inmediato - immediate","instante - instant","insultaba - he/she used to insult / was insulting","intención - intention","intentó - tried / attempted","inundación - flood","joven - young","junto - together","juraba - he/she used to swear / was swearing","juramento - oath","la - the (feminine singular)","lamentaba - he/she regretted / lamented","las - the (feminine plural)","lastimar - to hurt / to injure","látigo - whip","le - to him, to her, to it, to you (formal) (indirect object pronoun)","les - to them / for them (indirect object pronoun)","llama - calls / flame","llamaban - called","llamaron - they called","llamó - he/she/it called (from llamar)","llegaron - they arrived","llevaban - they carried / wore / were taking","llevado - taken / carried / worn","llevó - took / carried / led","llovía - it was raining","lluvia - rain","lo - it / him!","lobo - wolf","logró - he/she managed to / succeeded in","loro - parrot","loros - parrots","los - the (masculine plural)","luego - then, later","lugar - place","mala - bad (feminine)","maldecía - he/she cursed / was cursing","malvado - evil","mano - hand","más - more","matón - bully / thug / killer","medio - means / medium","mejor - better / best","mentira - lie","menudo - small / minor / often (context-dependent)","metido - put in / stuck in / involved in (slang: “meddled”)","mí - me (object pronoun)","mi - my","miedo - fear","mientras - while","mimaban - they spoiled / pampered","miserable - miserable / wretched / stingy","mismo - same, himself/herself/itself (after a pronoun)","modos - ways / manners / modes","montón - pile / heap / lot","morir - to die","mosca - fly (insect)","mostrar - to show","mostró - showed","mucho - much, a lot","muerte - death","mundo - world","murieron - they died","murió - he/she died","muy - very","nació - he/she/it was born (from nacer)","nada - nothing","nadando - swimming","nadie - nobody / no one","nariz - nose","necesitas - you need","ni - nor, neither, not even","ningún - no, not any (masculine singular, shortened form of ninguno)","nos - us / to us / ourselves","nubes - clouds","nuevo - new","número - number","nunca - never","o - or","obstinado - stubborn","odiaba - he/she hated","ojo - eye","oportunidad - opportunity, chance","orilla - shore","orillas - shores / banks / edges","oro - gold","oscureció - darkened / got dark","oscuro - dark","otro - other, another (masculine singular)","otros - others (masculine plural)","pagaré - (repeated) I will pay","pague - he/she pay (subjunctive)","país - country","pájaro - bird","paloma - dove / pigeon","par - pair","para - for, in order to","pareces - you seem / you look","parecía - it seemed / he/she seemed","parte - part","paseo - walk / ride / stroll","pensaba - I thought","pensar - to think","pensaron - they thought","pensó - he/she/it thought (from pensar)","pequeña - small","perezosas - lazy (feminine plural)","perezoso - lazy / sloth (animal)","pero - but","picos - beaks / peaks / picks","piedra - stone","pies - feet","plata - silver","pobre - poor","poco - little / few / bit","podemos - we can","poder - power / to be able","podíamos - we could / we were able to","pondría - he/she would put / place","pone - he/she puts / places","por - by, for, through","porque - because","preguntaron - they asked","preocupaba - he/she was worrying / used to worry","primero - first","príncipe - prince","promesa - promise","promete - he/she promises","pronto - soon","propia - own (feminine singular)","proverbio - proverb","prueba - test / proof / try","pudiera - could","pueblo - town, village, people","puede - he/she can / you can (formal)","puedes - you can (from poder)","puedo - i can, i am able to (from poder)","puré - puree / mashed (as in *puré de papas* = mashed potatoes)","que - that, what","qué - what","quejó - he/she complained","quienes - those who","quieras - you want (subjunctive)","quiere - he/she wants","quieres - you want","raíz - root","rápido - fast, quick, quickly","rata - rat","recompensarte - to reward you","refrán - proverb / saying","renunciaría - he/she would resign / would give up","resto - rest, remainder","rey - king","rico - tasty / delicious","riéndose - laughing (reflexive)","río - river","riquezas - riches / wealth","robarme - to rob me / steal from me","sabía - knew (from saber)","sacarlo - to take it / him out","sacó - took out","salió - went out / came out","salvado - saved","salvar - to save","se - oneself, himself, herself, itself, themselves (reflexive pronoun), or used in impersonal constructions","secó - dried / wiped","seguía - continued","sentado - seated","sentidos - senses","ser - to be","serpiente - snake","si - if","sí - yes, himself/herself/itself/themselves (reflexive after a preposition)","sido - been (past participle of ser)","siempre - always","sin - without","sirvientes - servants","sobre - on / over / about","sol - sun / alone","solo - only, alone","son - are","soy - i am","su - his, her, its, their, your (formal)","subiéndose - climbing up / getting on","subió - went up","sucedió - happened","suelo - ground / floor","suerte - luck","suficiente - sufficient","superado - overcome / surpassed","supongo - i suppose","sus - his, her, its, their, your (formal) (plural)","tal - such","también - also, too","tan - so / such / as","tanto - so much, as much","te - you (informal singular) (direct or indirect object pronoun)","tendrás - you will have","tener - to have","tengo - i have","tenía - had (from tener)","tenido - had","tesoro - treasure","ti - you (after a preposition)","tiempo - time, weather","tiene - has","tienes - you have (from tener)","tipo - type / kind / guy","toda - all, whole (feminine singular)","todas - all (feminine plural)","todo - all, whole, everything","todos - all (masculine plural)","tomó - he/she took","tormenta - storm","través - through","tres - three","tuviera - i/he/she had (subjunctive)","tuvo - he/she/it had (from tener)","último - final","un - a, an (masculine)","una - a, an (feminine)","uno - one (masculine)","usarlo - to use it / him","ven - come","venir - to come","vez - time / occasion","viajó - he/she traveled","vida - life","vidas - lives","vieron - they saw","vio - he/she/it saw (from ver)","visita - visit (noun or 3rd-person verb: “he/she visits”)","vivía - lived / was living","vivieron - they lived","vivir - to live","volaba - he/she was flying / used to fly","volar - to fly","voló - flew","volvió - returned","voz - voice","y - and","zapato - shoe"]`;
var slm = `{"a":{"start":0,"end":49},"á":{"start":32,"end":32},"b":{"start":50,"end":64},"c":{"start":65,"end":101},"d":{"start":102,"end":133},"e":{"start":134,"end":167},"é":{"start":136,"end":136},"f":{"start":168,"end":180},"g":{"start":181,"end":193},"h":{"start":194,"end":212},"i":{"start":213,"end":222},"j":{"start":223,"end":226},"l":{"start":227,"end":251},"m":{"start":252,"end":281},"n":{"start":282,"end":294},"o":{"start":295,"end":306},"p":{"start":307,"end":354},"q":{"start":355,"end":361},"r":{"start":362,"end":374},"s":{"start":375,"end":408},"t":{"start":409,"end":434},"ú":{"start":435,"end":435},"u":{"start":436,"end":439},"v":{"start":440,"end":456},"y":{"start":457,"end":457},"z":{"start":458,"end":458}}`;

var EHIMGURL;
if(storyline.gtUrl.indexOf('https:') === 0){
    EHIMGURL = 'https://ik.imagekit.io/pnscgil5d/';
}
else{
    EHIMGURL = './jiveRPG/xternal/easternHead/';
}
const ehbmtitle = 'beastPrince';


storyline.intro = `<p>The source of this story comes from The Project Gutenberg eBook of "The Giant Crab, and Other Tales from Old India" written by W. H. D. Rouse, meant to
amuse children</p>
<div style="font-size:smaller;">
<p>Credits:</p>
<p>Story Text:<br><a href="https://www.gutenberg.org/ebooks/36039" target="_blank">The Giant Crab, and Other Tales from Old India by W. H. D. Rouse - The Project Gutenberg</a></p>
<p>Translation:<br> AIs</p>
<p>Images:<br><ul><li><a href="https://www.rawpixel.com" target="_blank">rawpixel.com</a></li><li><a href="https://www.pixabay.com" target="_blank">pixabay.com</a></li></ul></p></div>`;

storyline.lang = ['EN','ES'];
storyline.clang = storyline.deflang = 'es';

var reperc = {
    starter:false,
    storylines:[],
    starterParagraph:false,
    bmidx:false,
    storyvis:['a.jpg','b.jpg','c.jpg','d.jpg','e.jpg','f.jpg','g.jpg','h.jpg','i.jpg','j.jpg','k.jpg','l.jpg','m.jpg','n.jpg','o.jpg','p.jpg','q.jpg','r.jpg','s.jpg','t.jpg','u.jpg','v.jpg','w.jpg','x.jpg','y.jpg','z.jpg','1a.jpg','1b.jpg','1c.jpg','1d.jpg','1e.jpg','1f.jpg'],
    setBookmark:function(x){
        if(reperc.localstorage == false){return;}
        reperc.bookmark[reperc.bmidx].cpar = x;
        reperc.localstorage.setItem('easternHeadBM',JSON.stringify(reperc.bookmark));
    },
    initBookmark:function(){
        if (typeof localStorage == "object"){
            reperc.localstorage =  localStorage;
        } else if (typeof globalStorage == "object"){
            reperc.localstorage = globalStorage[location.host];
        } else {
            reperc.localstorage = false;
        }
        if(reperc.localstorage !== false){
            reperc.bookmark = reperc.localstorage.getItem('easternHeadBM');
            if(reperc.bookmark == null){
                reperc.bookmark = [];
                reperc.bmidx = 0;
                reperc.bookmark[0] = {title:ehbmtitle,cpar:0};
            }
            else{
                reperc.bookmark = JSON.parse(reperc.bookmark);
                for(var i=0;i<reperc.bookmark.length;i++){
                    if(reperc.bookmark[i].title == ehbmtitle){
                        reperc.starterParagraph = reperc.bookmark[i].cpar;
                        reperc.bmidx = i;
                        break;
                    }
                }
                if(reperc.bmidx === false){
                    reperc.bmidx = reperc.bookmark.length;
                    reperc.bookmark[reperc.bmidx] = {title:ehbmtitle,cpar:0};
                }
            }
        }
    },
    initDictionary:function(){
        spanishDictionary = JSON.parse(spanishDictionary);
        reperc.letterMap = JSON.parse(slm);
    },
    initStory:function(){
        reperc.initBookmark();
        reperc.initDictionary();
        reperc.storyvidx = [];
        for(var i=0;i<reperc.storyvis.length;i++){
            reperc.storyvidx[reperc.storyvidx.length] = i;
        }
        textSt = textSt.split('<muoborder>');
        for(var i=0;i<textSt.length;i++){
            textSt[i] = textSt[i].trim();
            if(textSt[i] == '') continue;
            reperc.storylines[i] = [];
            textSt[i] = textSt[i].split('\n');
            for(var ix=0;ix<textSt[i].length;ix++){
                textSt[i][ix] = textSt[i][ix].trim();
                if(textSt[i][ix] == '') continue;
                reperc.storylines[i][reperc.storylines[i].length] = textSt[i][ix];
            }
        }
	},
    nextHdlr:function(x){
     if(x%2 == 0){
          var stvidx = jovuniverse.getrand(0,reperc.storyvidx.length);
          var stvi = reperc.storyvidx[stvidx];
          storyline.chapters[storyline.current_chap].elements.narration.illustration = EHIMGURL+reperc.storyvis[stvi];
          reperc.storyvidx.splice(stvidx,1);
          if(!reperc.storyvidx.length){
              for(var i=0;i<reperc.storyvis.length;i++){
                  reperc.storyvidx[reperc.storyvidx.length] = i;
              }
          }
        }
        reperc.setBookmark(x);
    },
    rp:function(){
        storyline.current_chap = reperc.starter;
        if(reperc.starterParagraph !== false){
          storyline.unfold_ = true;
          storyline.chapters[storyline.current_chap].unfoldx(reperc.starterParagraph);
        }
        else {
          storyline.chapters[storyline.current_chap].unfold();
        }
        $('#text5').css('object-fit','contain');
        var stvidx = jovuniverse.getrand(0,reperc.storyvidx.length);
        var stvi = reperc.storyvidx[stvidx];
        storyline.chapters[storyline.current_chap].elements.narration.illustration = EHIMGURL+reperc.storyvis[stvi];
        reperc.storyvidx.splice(stvidx,1);
        
        document.addEventListener('unfoldx', e => {
            reperc.nextHdlr(e.detail);          
        });
  }
};

var chidx;
var n;

reperc.starter = 1;
config = {type:'repercussion',effect:new repercussion(reperc.rp),prerequisite:false};
chidx = storyline.addChapter(config);

reperc.initStory();
config = {type:'narration',narration:false};
n = new narration();
for(var i=0;i<reperc.storylines[1].length;i++){
    //es,en,fr,de,it,ru,ja,ko
	n.addNarration(reperc.storylines[1][i],reperc.storylines[0][i],null,null,null,null,null,null);
}
n.illustration = EHIMGURL+'1d.jpg';
config.narration = n;
chidx = storyline.addChapter(config);

storyline.dictionfn = function(t,l){
    $('#dictionary').remove();
    $('.txtfrg.inq').removeClass('inq');
    const pos = $(l).offset();
    $(l).addClass('inq');
    t = t.toLowerCase().replace(/^[\p{P}\p{S}\s]+|[\p{P}\p{S}\s]+$/gu, '');
    t = t +' - ';
    let xx = t[0].toLowerCase();

    if(storyline.clang == 'es'){
        if (!reperc.letterMap[xx]){
            window.open('https://translate.google.com/?sl='+storyline.clang+'&tl=en&text='+t+'&op=translate');
            return;
        }
        for(var i=reperc.letterMap[xx].start;i<=reperc.letterMap[xx].end;i++){
            if(spanishDictionary[i].indexOf(t) === 0){
                $('body').append('<div id="dictionary" style="top:'+(pos.top-40)+'px;left:'+pos.left+'px;">'+spanishDictionary[i].split(' - ')[1]+'</div>').addClass('dictionInq');
                return;
            }
        }
        window.open('https://translate.google.com/?sl='+storyline.clang+'&tl=en&text='+t+'&op=translate');
    }
};
$('#text5').prop('src',EHIMGURL+'1m.jpg');
